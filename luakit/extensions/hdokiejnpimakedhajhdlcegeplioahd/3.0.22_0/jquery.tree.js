var g_CNTfun=0,lastdblclick=new Date,g_tree=null;
(function(f){function c(){return{cntr:++c.cntr,settings:f.extend({},f.tree.defaults),init:function(a,b){g_tree=this;this.container=f(a);if(0==this.container.size)return!1;c.inst[this.cntr]=this;this.container.attr("id")||this.container.attr("id","jstree_"+this.cntr);c.inst[this.container.attr("id")]=c.inst[this.cntr];c.focused=this.cntr;this.settings=f.extend(!0,{},this.settings,b);if(this.settings.languages&&this.settings.languages.length){this.current_lang=this.settings.languages[0];for(var h=!1,
d="#"+this.container.attr("id"),e=0;e<this.settings.languages.length;e++)h=c.add_css(d+" ."+this.settings.languages[e]),!1!==h&&(h.style.display=this.settings.languages[e]==this.current_lang?"":"none")}else this.current_lang=!1;this.container.addClass("tree");!1!==this.settings.ui.theme_name&&(""!=this.settings.ui.theme_path&&-1==f.inArray(this.settings.ui.theme_path,c.themes)&&(c.add_sheet({url:this.settings.ui.theme_path}),c.themes.push(this.settings.ui.theme_path)),this.container.addClass("tree-"+
this.settings.ui.theme_name));var h="",g;for(g in this.settings.types)if(this.settings.types.hasOwnProperty(g)&&this.settings.types[g].icon&&(this.settings.types[g].icon.image||this.settings.types[g].icon.position))h="default"==g?h+("#"+this.container.attr("id")+" li > a ins { "):h+("#"+this.container.attr("id")+" li[rel="+g+"] > a ins { "),this.settings.types[g].icon.image&&(h+=" background-image:url("+this.settings.types[g].icon.image+"); "),this.settings.types[g].icon.position&&(h+=" background-position:"+
this.settings.types[g].icon.position+"; "),h+="} ";""!=h&&c.add_sheet({str:h});this.settings.rules.multiple&&(this.selected_arr=[]);this.locked=this.hovered=this.offset=!1;!1===c.drag_drop.marker&&(c.drag_drop.marker=f("<div>").attr({id:"jstree-marker"}).hide().appendTo("body"));this.callback("oninit",[this]);this.refresh();this.attach_events();this.focus()},refresh:function(a){if(this.locked)return this.error("LOCKED");var b=this;a&&!this.settings.data.async&&(a=!1);this.is_partial_refresh=a?!0:
!1;this.opened=[];!1!=this.settings.opened?(f.each(this.settings.opened,function(){0<this.replace(/^#/,"").length&&b.opened.push("#"+this.replace(/^#/,""))}),this.settings.opened=!1):this.container.find("li.open").each(function(){this.id&&b.opened.push("#"+this.id)});if(this.selected)this.settings.selected=[],a?f(a).find("li:has(a.clicked)").each(function(){this.id&&b.settings.selected.push("#"+this.id)}):this.selected_arr?f.each(this.selected_arr,function(){this.attr("id")&&b.settings.selected.push("#"+
this.attr("id"))}):this.selected.attr("id")&&this.settings.selected.push("#"+this.selected.attr("id"));else if(!1!==this.settings.selected){var c=[];"object"==(typeof this.settings.selected).toLowerCase()?f.each(this.settings.selected,function(){0<this.replace(/^#/,"").length&&c.push("#"+this.replace(/^#/,""))}):0<this.settings.selected.replace(/^#/,"").length&&c.push("#"+this.settings.selected.replace(/^#/,""));this.settings.selected=c}if(a&&this.settings.data.async)return this.opened=[],a=this.get_node(a),
a.find("li.open").each(function(){b.opened.push("#"+this.id)}),a.hasClass("open")&&a.removeClass("open").addClass("closed"),a.hasClass("leaf")&&a.removeClass("leaf"),a.children("ul:eq(0)").html(""),this.open_branch(a,!0,function(){b.reselect.apply(b)});var b=this,d=new f.tree.datastores[this.settings.data.type];0==this.container.children("ul").size()&&this.container.html("<ul class='ltr' style='direction:ltr;'><li class='last'><a class='loading' href='#'><ins>&nbsp;</ins>"+(this.settings.lang.loading||
"Loading ...")+"</a></li></ul>");d.load(this.callback("beforedata",[!1,this]),this,this.settings.data.opts,function(a){a=b.callback("ondata",[a,b]);d.parse(a,b,b.settings.data.opts,function(a){a=b.callback("onparse",[a,b]);b.container.empty().append(f("<ul class='ltr'>").html(a));b.container.find("li:last-child").addClass("last").end().find("li:has(ul)").not(".open").addClass("closed");b.container.find("li").not(".open").not(".closed").addClass("leaf");b.reselect()})})},reselect:function(a){var b=
this;a?this.cl_count--:this.cl_count=0;if(this.opened&&this.opened.length){a=!1;for(var c=0;this.opened&&c<this.opened.length;c++)if(this.settings.data.async){var d=this.get_node(this.opened[c]);d.size()&&0<d.hasClass("closed")&&(a=!0,d=this.opened[c].toString().replace("/","\\/"),delete this.opened[c],this.open_branch(d,!0,function(){b.reselect.apply(b,[!0])}),this.cl_count++)}else this.open_branch(this.opened[c],!0);if(this.settings.data.async&&a||0<this.cl_count)return;delete this.opened}0<this.cl_count||
(this.container.css("direction","ltr").children("ul:eq(0)").addClass("ltr"),!1==this.settings.ui.dots&&this.container.children("ul:eq(0)").addClass("no_dots"),this.scrtop&&(this.container.scrollTop(b.scrtop),delete this.scrtop),!1!==this.settings.selected&&(f.each(this.settings.selected,function(a){b.is_partial_refresh?b.select_branch(f(b.settings.selected[a].toString().replace("/","\\/"),b.container),!1!==b.settings.rules.multiple):b.select_branch(f(b.settings.selected[a].toString().replace("/",
"\\/"),b.container),!1!==b.settings.rules.multiple&&0<a)}),this.settings.selected=!1),this.callback("onload",[b]))},get:function(a,b,c){b||(b=this.settings.data.type);c||(c=this.settings.data.opts);return(new f.tree.datastores[b]).get(a,this,c)},attach_events:function(){var a=this;this.container.bind("mousedown.jstree",function(a){if(c.drag_drop.isdown)return c.drag_drop.move_type=!1,a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation(),!1}).bind("mouseup.jstree",function(){setTimeout(function(){a.focus.apply(a)},
5)}).bind("click.jstree",function(){return!0});f("li",this.container.get(0)).live("click",function(b){if("LI"!=b.target.tagName&&"A"!=b.target.tagName)return!0;a.off_height();if(b.pageY-f(b.target).offset().top>a.li_height)return!0;a.toggle_branch.apply(a,[b.target]);b.stopPropagation();return!1}).live("contextmenu",function(b){return a.locked?(b.target.blur(),a.error("LOCKED")):a.callback("onrgtclk",[a.get_node(b.target).get(0),a,b])}).live("mousedown",function(b){a.domousedown(b)});f("a",this.container.get(0)).live("click",
function(b){if(b.which&&3==b.which)return!0;if(a.locked)return b.preventDefault(),b.target.blur(),a.error("LOCKED");if(b.target.hasAttribute("isgroup")){a.off_height();if(b.pageY-f(b.target).offset().top>a.li_height)return!0;a.toggle_branch.apply(a,[b.target])}else a.select_branch.apply(a,[b.target,b.ctrlKey||"on"==a.settings.rules.multiple,b.shiftKey]);a.inp&&a.inp.blur();b.preventDefault();b.target.blur();return!1}).live("dblclick",function(b){if(a.locked)return b.preventDefault(),b.stopPropagation(),
b.target.blur(),a.error("LOCKED");a.callback("ondblclk",[a.get_node(b.target).get(0),a]);b.preventDefault();b.stopPropagation();b.target.blur()}).live("contextmenu",function(b){return a.locked?(b.target.blur(),a.error("LOCKED")):a.callback("onrgtclk",[a.get_node(b.target).get(0),a,b])}).live("mouseover",function(b){if(a.locked)return b.preventDefault(),b.stopPropagation(),a.error("LOCKED");if(!1!==a.hovered&&("A"==b.target.tagName||"INS"==b.target.tagName))a.hovered.children("a").removeClass("hover"),
a.hovered=!1;a.callback("onhover",[a.get_node(b.target).get(0),a])}).live("mousedown",function(b){a.domousedown(b)})},domousedown:function(a){for(var b=!1,h=a.target;h;){if("function"==typeof h.getAttribute&&"thetree"==h.getAttribute("id")){b=!0;break}h=h.parentNode}if(b){_this=g_tree;if("left"==_this.settings.rules.drag_button&&a.which&&1!=a.which||"right"==_this.settings.rules.drag_button&&a.which&&3!=a.which)return!0;_this.focus.apply(_this);if(_this.locked)return _this.error("LOCKED");b=_this.get_node(a.target);
if(!1!=_this.settings.rules.multiple&&1<_this.selected_arr.length&&b.children("a:eq(0)").hasClass("clicked")){var d=0,e;for(e in _this.selected_arr)_this.selected_arr.hasOwnProperty(e)&&_this.check("draggable",_this.selected_arr[e])&&(_this.selected_arr[e].addClass("dragged"),c.drag_drop.origin_tree=_this,d++);0<d&&(c.drag_drop.drag_node=_this.check("draggable",b)?b:_this.container.find("li.dragged:eq(0)"),c.drag_drop.isdown=!0,"function"==typeof getDragHTML?c.drag_drop.drag_help=f(getDragHTML(null)):
(c.drag_drop.drag_help=f("<div id='jstree-dragged' class='tree "+(""!=_this.settings.ui.theme_name?" tree-"+_this.settings.ui.theme_name:"")+"' />").append("<ul class='"+_this.container.children("ul:eq(0)").get(0).className+"' />"),d=c.drag_drop.drag_node.clone(),0<_this.settings.languages.length&&d.find("a").not("."+_this.current_lang).hide(),c.drag_drop.drag_help.children("ul:eq(0)").append(d),c.drag_drop.drag_help.find("li:eq(0)").removeClass("last").addClass("last").children("a").html("<ins>&nbsp;</ins>Multiple selection").end().children("ul").remove()),
c.drag_drop.dragged=_this.container.find("li.dragged"))}else _this.check("draggable",b)&&(0<_this.settings.languages.length&&d.find("a").not("."+_this.current_lang).hide(),c.drag_drop.drag_node=b,d=b.clone(),"function"==typeof getDragHTML?c.drag_drop.drag_help=f(getDragHTML(d)):(c.drag_drop.drag_help=f("<div id='jstree-dragged' class='tree "+(""!=_this.settings.ui.theme_name?" tree-"+_this.settings.ui.theme_name:"")+"' />").append("<ul class='"+_this.container.children("ul:eq(0)").get(0).className+
"' />"),c.drag_drop.drag_help.children("ul:eq(0)").append(getDragHTML(d)),c.drag_drop.drag_help.find("li:eq(0)").removeClass("last").addClass("last")),c.drag_drop.isdown=!0,c.drag_drop.foreign=!1,c.drag_drop.origin_tree=_this,b.addClass("dragged"),c.drag_drop.dragged=_this.container.find("li.dragged"));c.drag_drop.init_x=a.pageX;c.drag_drop.init_y=a.pageY;b.blur();a.preventDefault();a.stopPropagation();return!1}},focus:function(){if(this.locked)return!1;c.focused!=this.cntr&&(c.focused=this.cntr,
this.callback("onfocus",[this]))},off_height:function(){if(!1===this.offset){this.container.css({position:"relative"});this.offset=this.container.offset();var a=0;if(a=parseInt(f.curCSS(this.container.get(0),"paddingTop",!0),10))this.offset.top+=a;if(a=parseInt(f.curCSS(this.container.get(0),"borderTopWidth",!0),10))this.offset.top+=a;this.container.css({position:""})}isSafariNative()&&!this.li_height?this.li_height=20:this.li_height||(a=this.container.find("ul li.closed, ul li.leaf").eq(0),this.li_height=
a.height(),a.children("ul:eq(0)").size()&&(this.li_height-=a.children("ul:eq(0)").height()),this.li_height||(this.li_height=18))},scroll_check:function(a,b){var h=this,d=h.container,e=h.container.offset(),g=d.scrollTop(),f=d.scrollLeft(),l=d.get(0).scrollWidth>d.width()?40:20;20>b-e.top&&d.scrollTop(Math.max(g-h.settings.ui.scroll_spd,0));d.height()-(b-e.top)<l&&d.scrollTop(g+h.settings.ui.scroll_spd);20>a-e.left&&d.scrollLeft(Math.max(f-h.settings.ui.scroll_spd,0));40>d.width()-(a-e.left)&&d.scrollLeft(f+
h.settings.ui.scroll_spd);if(d.scrollLeft()!=f||d.scrollTop()!=g)c.drag_drop.move_type=!1,c.drag_drop.ref_node=!1,c.drag_drop.marker.hide();c.drag_drop.scroll_time=setTimeout(function(){h.scroll_check(a,b)},50)},scroll_into_view:function(a){a=a?this.get_node(a):this.selected;if(!a)return!1;a=a.offset().top;var b=this.container.offset().top,c=b+this.container.height(),d=this.container.get(0).scrollWidth>this.container.width()?40:20;a+5<b&&this.container.scrollTop(this.container.scrollTop()-(b-a+5));
a+d>c&&this.container.scrollTop(this.container.scrollTop()+(a+d-c))},get_node:function(a){return f(a).closest("li")},get_type:function(a){if(a=!a?this.selected:this.get_node(a))return a.attr(this.settings.rules.type_attr)||"default"},set_type:function(a,b){(b=!b?this.selected:this.get_node(b))&&a&&b.attr(this.settings.rules.type_attr,a)},get_text:function(a,b){a=this.get_node(a);if(!a||0==a.size())return"";this.settings.languages&&this.settings.languages.length?(b=b?b:this.current_lang,a=a.children("a."+
b)):a=a.children("a:visible");var c="";a.contents().each(function(){if(3==this.nodeType)return c=this.data,!1});return c},check:function(a,b){if(this.locked)return!1;var c=!1;if(-1===b)"undefined"!=typeof this.settings.rules[a]&&(c=this.settings.rules[a]);else{b=!b?this.selected:this.get_node(b);if(!b)return;var d=this.get_type(b);"undefined"!=typeof this.settings.types[d]&&"undefined"!=typeof this.settings.types[d][a]?c=this.settings.types[d][a]:"undefined"!=typeof this.settings.types["default"]&&
"undefined"!=typeof this.settings.types["default"][a]&&(c=this.settings.types["default"][a])}"function"==typeof c&&(c=c.call(null,b,this));return c=this.callback("check",[a,b,c,this])},check_move:function(a,b,h){if(this.locked||f(b).closest("li.dragged").size())return!1;var d=a.parents(".tree:eq(0)").get(0),e=b.parents(".tree:eq(0)").get(0);if(d&&d!=e&&(e=f.tree.reference(e.id).settings.rules.multitree,"none"==e||f.isArray(e)&&-1==f.inArray(d.id,e)))return!1;e="inside"!=h?this.parent(b):this.get_node(b);
a=this.get_node(a);if(!1==e)return!1;var d=this.settings.rules.use_max_depth?this.check("max_depth",e):-1,g=this.settings.rules.use_max_children?this.check("max_children",e):-1,j=this.check("valid_children",e),l="string"==typeof a?a:this.get_type(a);if("undefined"!=typeof j&&("none"==j||"object"==typeof j&&-1==f.inArray(l,f.makeArray(j))))return!1;if(this.settings.rules.use_max_children&&"undefined"!=typeof g&&-1!=g){if(0==g)return!1;j=1;!0==c.drag_drop.moving&&!1==c.drag_drop.foreign&&(j=c.drag_drop.dragged.size(),
j-=e.find("> ul > li.dragged").size());if(g<e.find("> ul > li").size()+j)return!1}if(this.settings.rules.use_max_depth){if("undefined"!=typeof d&&0===d)return this.error("MOVE: MAX-DEPTH REACHED");d=0<d?d:!1;g=0;for(j=e;-1!==j;)if(j=this.parent(j),g++,e=this.check("max_depth",j),0<=e&&(d=!1===d?e-g:Math.min(d,e-g)),!1!==d&&0>=d)return this.error("MOVE: MAX-DEPTH REACHED");if(!1!==d&&0>=d)return this.error("MOVE: MAX-DEPTH REACHED");if(!1!==d&&(e=1,"string"!=typeof a))for(j=a;0<j.size();){if(0>d-e)return this.error("MOVE: MAX-DEPTH REACHED");
j=j.children("ul").children("li");e++}}return!1==this.callback("check_move",[a,b,h,this])?!1:!0},hover_branch:function(a){if(this.locked)return this.error("LOCKED");a=this.get_node(a);if(!a.size())return this.error("HOVER: NOT A VALID NODE");if(!this.check("clickable",a))return this.error("SELECT: NODE NOT SELECTABLE");this.hovered&&this.hovered.children("A").removeClass("hover");this.hovered=a;this.hovered.children("a").addClass("hover");this.scroll_into_view(this.hovered)},select_branch:function(a,
b,c){if(this.locked)return this.error("LOCKED");!a&&!1!==this.hovered&&(a=this.hovered);var d=this;a=d.get_node(a);if(!a.size())return this.error("SELECT: NOT A VALID NODE");a.children("a").removeClass("hover");if(!d.check("clickable",a))return this.error("SELECT: NODE NOT SELECTABLE");if(!1===d.callback("beforechange",[a.get(0),d]))return this.error("SELECT: STOPPED BY USER");if(!1!=this.settings.rules.multiple&&b&&0<a.children("a.clicked").size())return this.deselect_branch(a);if(!1!=this.settings.rules.multiple&&
(b||c)){if(c&&0<this.selected_arr.length){var e=this.selected_arr[this.selected_arr.length-1],g=this.container.find("li.leaf"),j=a.position().top,e=e.position().top,l=j>e?j:e,k=j<e?j:e;g.each(function(){if(0<f(this).height()){var b=f(this).position().top;b<l&&(b>k&&f(this).html()!=a.html())&&(d.selected_arr.push(f(this)),f(this).addClass("clicked"),f(this).children("A").addClass("clicked"))}})}this.selected_arr.push(a)}if(!1!=this.settings.rules.multiple&&!b&&!c){for(var m in this.selected_arr)this.selected_arr.hasOwnProperty(m)&&
(this.selected_arr[m].children("A").removeClass("clicked"),this.selected_arr[m].removeClass("clicked"),this.callback("ondeselect",[this.selected_arr[m].get(0),d]));this.selected_arr=[];this.selected_arr.push(a);this.selected&&this.selected.children("A").hasClass("clicked")&&(this.selected.children("A").removeClass("clicked"),this.selected.removeClass("clicked"),this.callback("ondeselect",[this.selected.get(0),d]))}!this.settings.rules.multiple&&this.selected&&(this.selected.children("A").removeClass("clicked"),
this.selected.removeClass("clicked"),this.callback("ondeselect",[this.selected.get(0),d]));this.selected=a;!1!==this.hovered&&(this.hovered.children("A").removeClass("hover"),this.hovered=a);this.selected.children("a").addClass("clicked").end().parents("li.closed").each(function(){d.open_branch(this,!0)});this.selected.addClass("clicked");this.scroll_into_view(this.selected);this.callback("onselect",[this.selected.get(0),d]);this.callback("onchange",[this.selected.get(0),d])},deselect_branch:function(a){if(this.locked)return this.error("LOCKED");
var b=this;a=this.get_node(a);if(0==a.children("a.clicked").size())return this.error("DESELECT: NODE NOT SELECTED");a.children("a").removeClass("clicked");a.removeClass("clicked");this.callback("ondeselect",[a.get(0),b]);!1!=this.settings.rules.multiple&&1<this.selected_arr.length?(this.selected_arr=[],this.container.find("a.clicked").filter(":first-child").parent().each(function(){b.selected_arr.push(f(this))}),a.get(0)==this.selected.get(0)&&(this.selected=this.selected_arr[0])):(!1!=this.settings.rules.multiple&&
(this.selected_arr=[]),this.selected=!1);this.callback("onchange",[a.get(0),b])},toggle_branch:function(a){if(this.locked)return this.error("LOCKED");a=this.get_node(a);if(a.hasClass("closed"))return this.open_branch(a);if(a.hasClass("open"))return this.close_branch(a)},open_branch:function(a,b,c){var d=this;if(this.locked)return this.error("LOCKED");a=this.get_node(a);if(!a.size())return this.error("OPEN: NO SUCH NODE");if(a.hasClass("leaf"))return this.error("OPEN: OPENING LEAF NODE");if(this.settings.data.async&&
0==a.find("li").size()){if(!1===this.callback("beforeopen",[a.get(0),this]))return this.error("OPEN: STOPPED BY USER");a.children("ul:eq(0)").remove().end().append("<ul><li class='last'><a class='loading' href='#'><ins>&nbsp;</ins>"+(d.settings.lang.loading||"Loading ...")+"</a></li></ul>");a.removeClass("closed").addClass("open");var e=new f.tree.datastores[this.settings.data.type];e.load(this.callback("beforedata",[a,this]),this,this.settings.data.opts,function(b){b=d.callback("ondata",[b,d]);!b||
0==b.length?(a.removeClass("closed").removeClass("open").addClass("leaf").children("ul").remove(),c&&c.call()):e.parse(b,d,d.settings.data.opts,function(b){b=d.callback("onparse",[b,d]);a.children("ul:eq(0)").replaceWith(f("<ul>").html(b));a.find("li:last-child").addClass("last").end().find("li:has(ul)").not(".open").addClass("closed");a.find("li").not(".open").not(".closed").addClass("leaf");d.open_branch.apply(d,[a]);c&&c.call()})})}else{if(!this.settings.data.async&&!1===this.callback("beforeopen",
[a.get(0),this]))return this.error("OPEN: STOPPED BY USER");0<parseInt(this.settings.ui.animation)&&!b?(a.children("ul:eq(0)").css("display","none"),a.removeClass("closed").addClass("open"),a.children("ul:eq(0)").slideDown(parseInt(this.settings.ui.animation),function(){f(this).css("display","");c&&c.call()})):(a.removeClass("closed").addClass("open"),c&&c.call());this.callback("onopen",[a.get(0),this])}return!0},close_branch:function(a,b){if(this.locked)return this.error("LOCKED");var c=this;a=this.get_node(a);
if(!a.size())return this.error("CLOSE: NO SUCH NODE");if(!1===c.callback("beforeclose",[a.get(0),c]))return this.error("CLOSE: STOPPED BY USER");0<parseInt(this.settings.ui.animation)&&!b&&1==a.children("ul:eq(0)").size()?a.children("ul:eq(0)").slideUp(parseInt(this.settings.ui.animation),function(){a.hasClass("open")&&a.removeClass("open").addClass("closed");f(this).css("display","")}):a.hasClass("open")&&a.removeClass("open").addClass("closed");this.selected&&(!1!==this.settings.ui.selected_parent_close&&
0<a.children("ul:eq(0)").find("a.clicked").size())&&(a.find("li:has(a.clicked)").each(function(){c.deselect_branch(this)}),"select_parent"==this.settings.ui.selected_parent_close&&0==a.children("a.clicked").size()&&this.select_branch(a,!1!=this.settings.rules.multiple&&0<this.selected_arr.length));this.callback("onclose",[a.get(0),this])},open_all:function(a,b){if(this.locked)return this.error("LOCKED");var c=this;a=a?this.get_node(a):this.container;var d=a.find("li.closed").size();b?this.cl_count--:
this.cl_count=0;0<d?(this.cl_count+=d,a.find("li.closed").each(function(){var a=this;c.open_branch.apply(c,[this,!0,function(){c.open_all.apply(c,[a,!0])}])})):0==this.cl_count&&this.callback("onopen_all",[this])},close_all:function(a){if(this.locked)return this.error("LOCKED");var b=this;a=a?this.get_node(a):this.container;a.find("li.open").each(function(){b.close_branch(this,!0)});this.callback("onclose_all",[this])},set_lang:function(a){if(!f.isArray(this.settings.languages)||0==this.settings.languages.length)return!1;
if(this.locked)return this.error("LOCKED");!f.inArray(a,this.settings.languages)&&"undefined"!=typeof this.settings.languages[a]&&(a=this.settings.languages[a]);if("undefined"==typeof a)return!1;if(a==this.current_lang)return!0;var b=!1,h="#"+this.container.attr("id"),b=c.get_css(h+" ."+this.current_lang);!1!==b&&(b.style.display="none");b=c.get_css(h+" ."+a);!1!==b&&(b.style.display="");this.current_lang=a;return!0},get_lang:function(){return!f.isArray(this.settings.languages)||0==this.settings.languages.length?
!1:this.current_lang},create:function(a,b,c){if(this.locked)return this.error("LOCKED");var d=!1;-1==b?(d=!0,b=this.container):b=b?this.get_node(b):this.selected;if(!d&&(!b||!b.size()))return this.error("CREATE: NO NODE SELECTED");var e=c,g=b;"before"==c&&(c=b.parent().children().index(b),b=b.parents("li:eq(0)"));"after"==c&&(c=b.parent().children().index(b)+1,b=b.parents("li:eq(0)"));!d&&0==b.size()&&(d=!0,b=this.container);if(!d){if(!this.check("creatable",b))return this.error("CREATE: CANNOT CREATE IN NODE");
if(b.hasClass("closed")){if(this.settings.data.async&&0==b.children("ul").size()){var j=this;return this.open_branch(b,!0,function(){j.create.apply(j,[a,b,c])})}this.open_branch(b,!0)}}var l=!1;a=a?f.extend(!0,{},a):{};a.attributes||(a.attributes={});a.attributes[this.settings.rules.type_attr]||(a.attributes[this.settings.rules.type_attr]=this.get_type(g)||"default");if(this.settings.languages.length){a.data||(a.data={},l=!0);for(var k=0;k<this.settings.languages.length;k++)a.data[this.settings.languages[k]]||
(a.data[this.settings.languages[k]]="string"!=(typeof this.settings.lang.new_node).toLowerCase()&&this.settings.lang.new_node[k]?this.settings.lang.new_node[k]:this.settings.lang.new_node)}else a.data||(a.data=this.settings.lang.new_node,l=!0);a=this.callback("ondata",[a,this]);g=f.tree.datastores.json().parse(a,this);g=this.callback("onparse",[g,this]);g=f(g);g.children("ul").size()?g.is(".open")||g.addClass("closed"):g.addClass("leaf");g.find("li:last-child").addClass("last").end().find("li:has(ul)").not(".open").addClass("closed");
g.find("li").not(".open").not(".closed").addClass("leaf");var m=this.settings.rules.use_max_depth?this.check("max_depth",d?-1:b):-1,n=this.settings.rules.use_max_children?this.check("max_children",d?-1:b):-1,k=this.check("valid_children",d?-1:b),p=this.get_type(g);if("undefined"!=typeof k&&("none"==k||f.isArray(k)&&-1==f.inArray(p,k)))return this.error("CREATE: NODE NOT A VALID CHILD");if(this.settings.rules.use_max_children&&"undefined"!=typeof n&&-1!=n&&n>=this.children(b).size())return this.error("CREATE: MAX_CHILDREN REACHED");
if(this.settings.rules.use_max_depth){if("undefined"!=typeof m&&0===m)return this.error("CREATE: MAX-DEPTH REACHED");m=0<m?m:!1;k=0;for(n=b;-1!==n&&!d;)if(n=this.parent(n),k++,p=this.check("max_depth",n),0<=p&&(m=!1===m?p-k:Math.min(m,p-k)),!1!==m&&0>=m)return this.error("CREATE: MAX-DEPTH REACHED");if(!1!==m&&0>=m)return this.error("CREATE: MAX-DEPTH REACHED");if(!1!==m){k=1;for(n=g;0<n.size();){if(0>m-k)return this.error("CREATE: MAX-DEPTH REACHED");n=n.children("ul").children("li");k++}}}if("undefined"==
(typeof c).toLowerCase()||"inside"==c)c="top"==this.settings.rules.createat?0:b.children("ul:eq(0)").children("li").size();if(!1===(0==b.children("ul").size()||!0==d&&0==b.children("ul").children("li").size()?d?this.moved(g,this.container.children("ul:eq(0)"),"inside",!0):this.moved(g,b.children("a:eq(0)"),"inside",!0):"before"==e&&b.children("ul:eq(0)").children("li:nth-child("+(c+1)+")").size()?this.moved(g,b.children("ul:eq(0)").children("li:nth-child("+(c+1)+")").children("a:eq(0)"),"before",
!0):"after"==e&&b.children("ul:eq(0)").children("li:nth-child("+c+")").size()?this.moved(g,b.children("ul:eq(0)").children("li:nth-child("+c+")").children("a:eq(0)"),"after",!0):b.children("ul:eq(0)").children("li:nth-child("+(c+1)+")").size()?this.moved(g,b.children("ul:eq(0)").children("li:nth-child("+(c+1)+")").children("a:eq(0)"),"before",!0):this.moved(g,b.children("ul:eq(0)").children("li:last").children("a:eq(0)"),"after",!0)))return this.error("CREATE: ABORTED");l&&(this.select_branch(g.children("a:eq(0)")),
this.rename());return g},rename:function(a,b){if(this.locked)return this.error("LOCKED");a=a?this.get_node(a):this.selected;var c=this;if(!a||!a.size())return this.error("RENAME: NO NODE SELECTED");if(!this.check("renameable",a))return this.error("RENAME: NODE NOT RENAMABLE");if(!this.callback("beforerename",[a.get(0),c.current_lang,c]))return this.error("RENAME: STOPPED BY USER");a.parents("li.closed").each(function(){c.open_branch(this)});a=this.current_lang?a.find("a."+this.current_lang):a.find("a:first");
var d={};d[this.container.attr("id")]=this.get_rollback();var e=a.children("ins").clone();if("string"==(typeof b).toLowerCase())a.text(b).prepend(e),c.callback("onrename",[c.get_node(a).get(0),c,d]);else{var g="";a.contents().each(function(){if(3==this.nodeType)return g=this.data,!1});c.inp=f("<input type='text' autocomplete='off' />");c.inp.val(g.replace(/&amp;/g,"&").replace(/&gt;/g,">").replace(/&lt;/g,"<")).bind("mousedown",function(a){a.stopPropagation()}).bind("mouseup",function(a){a.stopPropagation()}).bind("click",
function(a){a.stopPropagation()}).bind("keyup",function(a){a=a.keyCode||a.which;27==a?(this.value=g,this.blur()):13==a&&this.blur()});c.inp.blur(function(){""==this.value&&(this.value=g);a.text(this.value).prepend(e);a.get(0).style.display="";a.prevAll("span").remove();c.inp=!1;c.callback("onrename",[c.get_node(a).get(0),c,d])});var j=f("<span />").addClass(a.attr("class")).append(e).append(c.inp);a.get(0).style.display="none";a.parent().prepend(j);c.inp.get(0).focus();c.inp.get(0).select()}},remove:function(a){if(this.locked)return this.error("LOCKED");
var b=this,c={};c[this.container.attr("id")]=this.get_rollback();if(a&&(!this.selected||this.get_node(a).get(0)!=this.selected.get(0))){if(a=this.get_node(a),a.size()){if(!this.check("deletable",a))return this.error("DELETE: NODE NOT DELETABLE");if(!this.callback("beforedelete",[a.get(0),b]))return this.error("DELETE: STOPPED BY USER");$parent=a.parent();if(a.find("a.clicked").size()){var d=!1;b.selected_arr=[];this.container.find("a.clicked").filter(":first-child").parent().each(function(){!d&&this==
b.selected.get(0)&&(d=!0);if(-1!=f(this).parents().index(a))return!0;b.selected_arr.push(f(this))});d&&(this.selected=this.selected_arr[0]||!1)}a=a.remove();$parent.children("li:last").addClass("last");0==$parent.children("li").size()&&($li=$parent.parents("li:eq(0)"),$li.removeClass("open").removeClass("closed").addClass("leaf").children("ul").remove());this.callback("ondelete",[a.get(0),this,c])}}else if(this.selected){if(!this.check("deletable",this.selected))return this.error("DELETE: NODE NOT DELETABLE");
if(!this.callback("beforedelete",[this.selected.get(0),b]))return this.error("DELETE: STOPPED BY USER");$parent=this.selected.parent();a=this.selected;if(!1==this.settings.rules.multiple||1==this.selected_arr.length)var e=!0,g="select_previous"==this.settings.ui.selected_delete?this.prev(this.selected):!1;a=a.remove();$parent.children("li:last").addClass("last");0==$parent.children("li").size()&&($li=$parent.parents("li:eq(0)"),$li.removeClass("open").removeClass("closed").addClass("leaf").children("ul").remove());
!e&&!1!=this.settings.rules.multiple&&(b=this,this.selected_arr=[],this.container.find("a.clicked").filter(":first-child").parent().each(function(){b.selected_arr.push(f(this))}),0<this.selected_arr.length&&(this.selected=this.selected_arr[0],this.remove()));e&&g&&this.select_branch(g);this.callback("ondelete",[a.get(0),this,c])}else return this.error("DELETE: NO NODE SELECTED")},next:function(a,b){"function"==typeof this.get_node&&(a=this.get_node(a));return!a.size()?!1:b?0<a.nextAll("li").size()?
a.nextAll("li:eq(0)"):!1:a.hasClass("open")?a.find("li:eq(0)"):0<a.nextAll("li").size()?a.nextAll("li:eq(0)"):a.parents("li").next("li").eq(0)},prev:function(a,b){"function"==typeof this.get_node&&(a=this.get_node(a));if(!a.size())return!1;if(b)return 0<a.prevAll("li").size()?a.prevAll("li:eq(0)"):!1;if(a.prev("li").size()){for(a=a.prev("li").eq(0);a.hasClass("open");)a=a.children("ul:eq(0)").children("li:last");return a}return a.parents("li:eq(0)").size()?a.parents("li:eq(0)"):!1},parent:function(a){a=
this.get_node(a);return!a.size()?!1:a.parents("li:eq(0)").size()?a.parents("li:eq(0)"):-1},children:function(a){if(-1===a)return this.container.children("ul:eq(0)").children("li");a=this.get_node(a);return!a.size()?!1:a.children("ul:eq(0)").children("li")},toggle_dots:function(){this.settings.ui.dots?(this.settings.ui.dots=!1,this.container.children("ul:eq(0)").addClass("no_dots")):(this.settings.ui.dots=!0,this.container.children("ul:eq(0)").removeClass("no_dots"))},callback:function(a,b){var c=
!1,d=null,e;for(e in this.settings.plugins)if("object"==typeof f.tree.plugins[e]&&(c=f.tree.plugins[e],c.callbacks&&"function"==typeof c.callbacks[a]&&(d=c.callbacks[a].apply(this,b)),"undefined"!==typeof d&&null!==d))if("ondata"==a||"onparse"==a)b[0]=d;else return d;c=this.settings.callback[a];if("function"==typeof c)return c.apply(null,b)},get_rollback:function(){var a={};a.html=this.container.html();a.selected=this.selected?this.selected.attr("id"):!1;return a},moved:function(a,b,h,d,e,g){a=f(a);
var j=f(a).parents("ul:eq(0)"),l=f(b);l.is("ins")&&(l=l.parent());if(!g&&(g={},g[this.container.attr("id")]=this.get_rollback(),!d)){var k=1<a.size()?a.eq(0).parents(".tree:eq(0)"):a.parents(".tree:eq(0)");k.get(0)!=this.container.get(0)&&(k=c.inst[k.attr("id")],g[k.container.attr("id")]=k.get_rollback());delete k}if("inside"==h&&this.settings.data.async){var m=this;if(this.get_node(l).hasClass("closed"))return this.open_branch(this.get_node(l),!0,function(){m.moved.apply(m,[a,b,h,d,e,g])});if(1==
this.get_node(l).find("> ul > li > a.loading").size()){setTimeout(function(){m.moved.apply(m,[a,b,h,d,e])},200);return}}if(1<a.size())return m=this,k=this.moved(a.eq(0),b,h,!1,e,g),a.each(function(a){0!=a&&k&&(k=m.moved(this,k.children("a:eq(0)"),"after",!1,e,g))}),a;e?(_what=a.clone(),_what.each(function(){this.id+="_copy";f(this).find("li").each(function(){this.id+="_copy"});f(this).removeClass("dragged").find("a.clicked").removeClass("clicked").end().find("li.dragged").removeClass("dragged");f(this).removeClass("dragged").find("li.clicked").removeClass("clicked").end().find("li.dragged").removeClass("dragged")})):
_what=a;if(d){if(!this.callback("beforecreate",[this.get_node(a).get(0),this.get_node(b).get(0),h,this]))return!1}else if(!this.callback("beforemove",[a,b,h,this]))return!1;if(!d&&(k=a.parents(".tree:eq(0)"),k.get(0)!=this.container.get(0))){k=c.inst[k.attr("id")];if(k.settings.languages.length){var n=[];if(0==this.settings.languages.length)n.push("."+k.current_lang);else for(var p in this.settings.languages)if(this.settings.languages.hasOwnProperty(p))for(var q in k.settings.languages)k.settings.languages.hasOwnProperty(q)&&
this.settings.languages[p]==k.settings.languages[q]&&n.push("."+this.settings.languages[p]);if(0==n.length)return this.error("MOVE: NO COMMON LANGUAGES");_what.find("a").not(n.join(",")).remove()}_what.find("a.clicked").removeClass("clicked");_what.find("li.clicked").removeClass("clicked")}a=_what;switch(h){case "before":l.parents("ul:eq(0)").children("li.last").removeClass("last");l.parent().before(a.removeClass("last"));l.parents("ul:eq(0)").children("li:last").addClass("last");break;case "after":l.parents("ul:eq(0)").children("li.last").removeClass("last");
l.parent().after(a.removeClass("last"));l.parents("ul:eq(0)").children("li:last").addClass("last");break;case "inside":l.parent().children("ul:first").size()?"top"==this.settings.rules.createat?(l.parent().children("ul:first").prepend(a.removeClass("last")).children("li:last").addClass("last"),n=l.parent().children("ul:first").children("li:first"),n.size()&&(h="before",b=n)):(n=l.parent().children("ul:first").children(".last"),n.size()&&(h="after",b=n),l.parent().children("ul:first").children(".last").removeClass("last").end().append(a.removeClass("last")).children("li:last").addClass("last")):
(a.addClass("last"),l.parent().removeClass("leaf").append("<ul/>"),l.parent().hasClass("open")||l.parent().addClass("closed"),l.parent().children("ul:first").prepend(a)),l.parent().hasClass("closed")&&this.open_branch(l)}0==j.find("li").size()?(j=j.parent(),j.removeClass("open").removeClass("closed").addClass("leaf"),j.is(".tree")||j.children("ul").remove(),j.parents("ul:eq(0)").children("li.last").removeClass("last").end().children("li:last").addClass("last")):(j.children("li.last").removeClass("last"),
j.children("li:last").addClass("last"));e?this.callback("oncopy",[this.get_node(a).get(0),this.get_node(b).get(0),h,this,g]):d?this.callback("oncreate",[this.get_node(a).get(0),l.is("ul")?-1:this.get_node(b).get(0),h,this,g]):this.callback("onmove",[this.get_node(a).get(0),this.get_node(b).get(0),h,this,g]);return a},error:function(a){this.callback("error",[a,this]);return!1},lock:function(a){(this.locked=a)?this.container.children("ul:eq(0)").addClass("locked"):this.container.children("ul:eq(0)").removeClass("locked")},
cut:function(a){if(this.locked)return this.error("LOCKED");a=a?this.get_node(a):this.container.find("a.clicked").filter(":first-child").parent();if(!a||!a.size())return this.error("CUT: NO NODE SELECTED");c.cut_copy.copy_nodes=!1;c.cut_copy.cut_nodes=a},copy:function(a){if(this.locked)return this.error("LOCKED");a=a?this.get_node(a):this.container.find("a.clicked").filter(":first-child").parent();if(!a||!a.size())return this.error("COPY: NO NODE SELECTED");c.cut_copy.copy_nodes=a;c.cut_copy.cut_nodes=
!1},paste:function(a,b){if(this.locked)return this.error("LOCKED");var h=!1;-1==a?(h=!0,a=this.container):a=a?this.get_node(a):this.selected;if(!h&&(!a||!a.size()))return this.error("PASTE: NO NODE SELECTED");if(!c.cut_copy.copy_nodes&&!c.cut_copy.cut_nodes)return this.error("PASTE: NOTHING TO DO");var d=b;if("before"==b)b=a.parent().children().index(a),a=a.parents("li:eq(0)");else if("after"==b)b=a.parent().children().index(a)+1,a=a.parents("li:eq(0)");else if("undefined"==(typeof b).toLowerCase()||
"inside"==b)b="top"==this.settings.rules.createat?0:a.children("ul:eq(0)").children("li").size();!h&&0==a.size()&&(h=!0,a=this.container);if(c.cut_copy.copy_nodes&&c.cut_copy.copy_nodes.size()){var e=!0;if(!h&&!this.check_move(c.cut_copy.copy_nodes,a.children("a:eq(0)"),"inside"))return!1;0==a.children("ul").size()||!0==h&&0==a.children("ul").children("li").size()?h?this.moved(c.cut_copy.copy_nodes,this.container.children("ul:eq(0)"),"inside",!1,!0):this.moved(c.cut_copy.copy_nodes,a.children("a:eq(0)"),
"inside",!1,!0):"before"==d&&a.children("ul:eq(0)").children("li:nth-child("+(b+1)+")").size()?this.moved(c.cut_copy.copy_nodes,a.children("ul:eq(0)").children("li:nth-child("+(b+1)+")").children("a:eq(0)"),"before",!1,!0):"after"==d&&a.children("ul:eq(0)").children("li:nth-child("+b+")").size()?this.moved(c.cut_copy.copy_nodes,a.children("ul:eq(0)").children("li:nth-child("+b+")").children("a:eq(0)"),"after",!1,!0):a.children("ul:eq(0)").children("li:nth-child("+(b+1)+")").size()?this.moved(c.cut_copy.copy_nodes,
a.children("ul:eq(0)").children("li:nth-child("+(b+1)+")").children("a:eq(0)"),"before",!1,!0):this.moved(c.cut_copy.copy_nodes,a.children("ul:eq(0)").children("li:last").children("a:eq(0)"),"after",!1,!0);c.cut_copy.copy_nodes=!1}if(c.cut_copy.cut_nodes&&c.cut_copy.cut_nodes.size()){e=!0;a.parents().andSelf().each(function(){if(-1!=c.cut_copy.cut_nodes.index(this))return e=!1});if(!e)return this.error("Invalid paste");if(!h&&!this.check_move(c.cut_copy.cut_nodes,a.children("a:eq(0)"),"inside"))return!1;
0==a.children("ul").size()||!0==h&&0==a.children("ul").children("li").size()?h?this.moved(c.cut_copy.cut_nodes,this.container.children("ul:eq(0)"),"inside"):this.moved(c.cut_copy.cut_nodes,a.children("a:eq(0)"),"inside"):"before"==d&&a.children("ul:eq(0)").children("li:nth-child("+(b+1)+")").size()?this.moved(c.cut_copy.cut_nodes,a.children("ul:eq(0)").children("li:nth-child("+(b+1)+")").children("a:eq(0)"),"before"):"after"==d&&a.children("ul:eq(0)").children("li:nth-child("+b+")").size()?this.moved(c.cut_copy.cut_nodes,
a.children("ul:eq(0)").children("li:nth-child("+b+")").children("a:eq(0)"),"after"):a.children("ul:eq(0)").children("li:nth-child("+(b+1)+")").size()?this.moved(c.cut_copy.cut_nodes,a.children("ul:eq(0)").children("li:nth-child("+(b+1)+")").children("a:eq(0)"),"before"):this.moved(c.cut_copy.cut_nodes,a.children("ul:eq(0)").children("li:last").children("a:eq(0)"),"after");c.cut_copy.cut_nodes=!1}},search:function(a,b){if(!a||this.srch&&a!=this.srch)this.srch="",this.srch_opn=!1,this.container.find("a.search").removeClass("search");
if(this.srch=a){b||(b="contains");a=a.toLowerCase();var c=null,d=search_string_tokenize(a);"undefined"!=g_all_li&&(null!=g_all_li&&0<=d.length)&&(g_CNTfun++,c=g_all_li.filter(function(){var a=search_it(this.id,d);this.style.display=a?"":"none";return a}),lp_display_folders(c,this),this.callback("onsearch",[c,this]))}},add_sheet:c.add_sheet,destroy:function(){this.callback("ondestroy",[this]);if("undefined"==typeof LPFromWebsite||"function"!=typeof LPFromWebsite.ipad)if(this.container.unbind(".jstree"),
f("#"+this.container.attr("id")).die("click.jstree").die("dblclick.jstree").die("mouseover.jstree").die("mouseout.jstree").die("mousedown.jstree"),this.container.removeClass("tree ui-widget ui-widget-content tree-default tree-"+this.settings.ui.theme_name).children("ul").removeClass("no_dots ltr locked").find("li").removeClass("leaf").removeClass("open").removeClass("closed").removeClass("last").children("a").removeClass("clicked hover search"),this.cntr==c.focused)for(var a in c.inst)if(a!=this.cntr&&
a!=this.container.attr("id")){c.inst[a].focus();break}c.inst[this.cntr]=!1;c.inst[this.container.attr("id")]=!1;delete c.inst[this.cntr];delete c.inst[this.container.attr("id")];c.cntr--}}}f.tree={datastores:{},plugins:{},defaults:{data:{async:!1,type:"html",opts:{method:"GET",url:!1}},selected:!1,opened:[],languages:[],ui:{dots:!0,animation:0,scroll_spd:7,theme_path:!1,theme_name:"default",selected_parent_close:"select_parent",selected_delete:"select_previous"},types:{"default":{clickable:!0,renameable:!0,
deletable:!0,creatable:!0,draggable:"undefined"==typeof LPFromWebsite||"function"!=typeof LPFromWebsite.ipad,max_children:-1,max_depth:-1,valid_children:"all",icon:{image:!1,position:!1}}},rules:{multiple:!1,multitree:"none",type_attr:"rel",createat:"bottom",drag_copy:"ctrl",drag_button:"left",use_max_children:!0,use_max_depth:!0,max_children:-1,max_depth:-1,valid_children:"all"},lang:{new_node:"New folder",loading:"Loading ..."},callback:{beforechange:function(){return!0},beforeopen:function(){return!0},
beforeclose:function(){return!0},beforemove:function(){return!0},beforecreate:function(){return!0},beforerename:function(){return!0},beforedelete:function(){return!0},beforedata:function(a){return{id:f(a).attr("id")||0}},ondata:function(a){return a},onparse:function(a){return a},onhover:function(){},onselect:function(){},ondeselect:function(){},onchange:function(){},onrename:function(){},onmove:function(){},oncopy:function(){},oncreate:function(){},ondelete:function(){},onopen:function(a,b){"function"==
typeof lponopen&&lponopen(a,b)},onopen_all:function(){},onclose_all:function(){},onclose:function(a,b){"function"==typeof lponclose&&lponclose(a,b)},error:function(){},ondblclk:function(a,b){var c=lastdblclick;lastdblclick=new Date;c.getTime()>lastdblclick.getTime()-1E3||(b.toggle_branch.call(b,a),b.select_branch.call(b,a))},onrgtclk:function(){},onload:function(){},oninit:function(){},onfocus:function(){},ondestroy:function(){},onsearch:function(a){a.addClass("search")},ondrop:function(){},check:function(a,
b,c){return c},check_move:function(){return!0}},plugins:{}},create:function(){return new c},focused:function(){return c.inst[c.focused]},reference:function(a){var b=f(a);b.size()||(b=f("#"+a));if(!b.size())return null;b=b.is(".tree")?b.attr("id"):b.parents(".tree:eq(0)").attr("id");return c.inst[b]||null},rollback:function(a){for(var b in a)if(a.hasOwnProperty(b)){var h=c.inst[b],d=!h.locked;d&&h.lock(!0);h.inp=!1;h.container.html(a[b].html).find(".dragged").removeClass("dragged").end().find(".hover").removeClass("hover");
a[b].selected&&(h.selected=f("#"+a[b].selected),h.selected_arr=[],h.container.find("a.clicked").each(function(){h.selected_arr.push(h.get_node(this))}));d&&h.lock(!1);delete d;delete h}},drop_mode:function(a){a=f.extend(a,{show:!1,type:"default",str:"Foreign node"});c.drag_drop.foreign=!0;c.drag_drop.isdown=!0;c.drag_drop.moving=!0;c.drag_drop.appended=!1;c.drag_drop.f_type=a.type;c.drag_drop.f_data=a;a.show?(c.drag_drop.drag_help=f("<div id='jstree-dragged' class='tree tree-default'><ul><li class='last dragged foreign'><a href='#'><ins>&nbsp;</ins>"+
a.str+"</a></li></ul></div>"),c.drag_drop.drag_node=c.drag_drop.drag_help.find("li:eq(0)")):(c.drag_drop.drag_help=!1,c.drag_drop.drag_node=!1);!1!==f.tree.drag_start&&f.tree.drag_start.call(null,!1)},drag_start:!1,drag:!1,drag_end:!1};f.fn.tree=function(a){return this.each(function(){var b=f.extend({},a);c.inst&&c.inst[f(this).attr("id")]&&c.inst[f(this).attr("id")].destroy();!1!==b&&(new c).init(this,b)})};c.cntr=0;c.inst={};c.themes=[];c.drag_drop={isdown:!1,drag_node:!1,drag_help:!1,dragged:!1,
init_x:!1,init_y:!1,moving:!1,origin_tree:!1,marker:!1,move_type:!1,ref_node:!1,appended:!1,foreign:!1,droppable:[],open_time:!1,scroll_time:!1};c.mouseup=function(a){var b=c.drag_drop;b.open_time&&clearTimeout(b.open_time);b.scroll_time&&clearTimeout(b.scroll_time);b.moving&&!1!==f.tree.drag_end&&f.tree.drag_end.call(null,a,b);if(!1===b.foreign&&b.drag_node&&b.drag_node.size()){b.drag_help.remove();if(b.move_type){var h=c.inst[b.ref_node.parents(".tree:eq(0)").attr("id")];h&&h.moved(b.dragged,b.ref_node,
b.move_type,!1,"on"==b.origin_tree.settings.rules.drag_copy||"ctrl"==b.origin_tree.settings.rules.drag_copy&&a.ctrlKey)}b.move_type=!1;b.ref_node=!1}!1!==b.foreign&&(b.drag_help&&b.drag_help.remove(),b.move_type&&(h=c.inst[b.ref_node.parents(".tree:eq(0)").attr("id")])&&h.callback("ondrop",[b.f_data,h.get_node(b.ref_node).get(0),b.move_type,h]),b.foreign=!1,b.move_type=!1,b.ref_node=!1);c.drag_drop.marker&&c.drag_drop.marker.hide();b.dragged&&b.dragged.size()&&b.dragged.removeClass("dragged");b.dragged=
!1;b.drag_help=!1;b.drag_node=!1;b.f_type=!1;b.f_data=!1;b.init_x=!1;b.init_y=!1;b.moving=!1;b.appended=!1;b.origin_tree=!1;if(b.isdown)return b.isdown=!1,a.preventDefault(),a.stopPropagation(),!1};c.mousemove=function(a){var b=c.drag_drop,h=!1;if(b.isdown){if(!b.moving&&5>Math.abs(b.init_x-a.pageX)&&5>Math.abs(b.init_y-a.pageY))return a.preventDefault(),a.stopPropagation(),!1;b.moving||(h=c.drag_drop.moving=!0);b.open_time&&clearTimeout(b.open_time);!1!==b.drag_help&&(b.appended||(!1!==b.foreign&&
(b.origin_tree=f.tree.focused()),f("body").append(b.drag_help),b.w=b.drag_help.width(),b.appended=!0),b.drag_help.css({left:a.pageX+5,top:a.pageY+15}));h&&!1!==f.tree.drag_start&&f.tree.drag_start.call(null,a,b);!1!==f.tree.drag&&f.tree.drag.call(null,a,b);if("DIV"==a.target.tagName&&"jstree-marker"==a.target.id)return!1;var d=f(a.target);d.is("ins")&&(d=d.parent());h=d.is(".tree")?d:d.parents(".tree:eq(0)");if(0==h.size()||!c.inst[h.attr("id")])return b.scroll_time&&clearTimeout(b.scroll_time),!1!==
b.drag_help&&b.drag_help.find("li:eq(0) ins").addClass("forbidden"),b.move_type=!1,b.ref_node=!1,c.drag_drop.marker.hide(),!1;var e=c.inst[h.attr("id")];e.off_height();b.scroll_time&&clearTimeout(b.scroll_time);b.scroll_time=setTimeout(function(){e.scroll_check(a.pageX,a.pageY)},50);var g=!1;h.scrollTop();if("A"==a.target.tagName||"INS"==a.target.tagName){if(d.is("#jstree-dragged"))return!1;e.get_node(a.target).hasClass("closed")&&(b.open_time=setTimeout(function(){e.open_branch(d)},500));var j=d.offset(),
l=j.left-1,k=a.pageY-j.top,m=[],m=k<e.li_height/3+1?["before","inside","after"]:k>2*e.li_height/3-1?["after","inside","before"]:k<e.li_height/2?["inside","before","after"]:["inside","after","before"],n=!1,p=!1==b.foreign?b.origin_tree.container.find("li.dragged"):b.f_type;f.each(m,function(a,b){if(e.check_move(p,d,b))return g=b,n=!0,!1});if(n){switch(g){case "before":k=j.top-2;c.drag_drop.marker.attr("class","marker");break;case "after":k=j.top-2+e.li_height;c.drag_drop.marker.attr("class","marker");
break;case "inside":l-=2,k=j.top-2+e.li_height/2,c.drag_drop.marker.attr("class","marker_plus")}b.move_type=g;b.ref_node=f(a.target);!1!==b.drag_help&&b.drag_help.find(".forbidden").removeClass("forbidden");c.drag_drop.marker.css({left:l,top:k}).show()}}if((d.is(".tree")||d.is("ul"))&&0==d.find("li:eq(0)").size())j=d.offset(),b.move_type="inside",b.ref_node=h.children("ul:eq(0)"),!1!==b.drag_help&&b.drag_help.find(".forbidden").removeClass("forbidden"),c.drag_drop.marker.attr("class","marker_plus"),
c.drag_drop.marker.css({left:j.left+10,top:j.top+15}).show();else if("A"!=a.target.tagName&&"INS"!=a.target.tagName||!n)!1!==b.drag_help&&b.drag_help.find("li:eq(0) ins").addClass("forbidden"),b.move_type=!1,b.ref_node=!1,c.drag_drop.marker.hide();a.preventDefault();a.stopPropagation();return!1}return!0};f(function(){f(document).bind("mousemove.jstree",c.mousemove);f(document).bind("mouseup.jstree",c.mouseup)});c.cut_copy={copy_nodes:!1,cut_nodes:!1};c.css=!1;c.get_css=function(a,b){a=a.toLowerCase();
var f=c.css.cssRules||c.css.rules,d=0;do{if(f.length&&d>f.length+5)break;if(f[d].selectorText&&f[d].selectorText.toLowerCase()==a)return!0==b?(c.css.removeRule&&document.styleSheets[i].removeRule(d),c.css.deleteRule&&document.styleSheets[i].deleteRule(d),!0):f[d]}while(f[++d]);return!1};c.add_css=function(a){if(c.get_css(a))return!1;c.css.insertRule?c.css.insertRule(a+" { }",0):c.css.addRule(a,null,0);return c.get_css(a)};c.remove_css=function(a){return c.get_css(a,!0)};c.add_sheet=function(a){if(a.str){var b=
document.createElement("style");b.setAttribute("type","text/css");b.styleSheet?(document.getElementsByTagName("head")[0].appendChild(b),b.styleSheet.cssText=a.str):(b.appendChild(document.createTextNode(a.str)),document.getElementsByTagName("head")[0].appendChild(b));return b.sheet||b.styleSheet}if(a.url)if(document.createStyleSheet)try{document.createStyleSheet(a.url)}catch(c){}else return b=document.createElement("link"),b.rel="stylesheet",b.type="text/css",b.media="all",b.href=a.url,document.getElementsByTagName("head")[0].appendChild(b),
b.styleSheet};f(function(){navigator.userAgent.toLowerCase().match(/.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/);var a='/* TREE LAYOUT */ .tree ul { margin:0 0 0 5px; padding:0 0 0 0; list-style-type:none; } .tree li { display:block; min-height:18px; line-height:18px; padding:0 0 0 15px; margin:0 0 0 0; /* Background fix */ clear:both; } .tree li ul { display:none; } .tree li a, .tree li span { display:inline-block;line-height:16px;height:16px;color:black;white-space:nowrap;text-decoration:none;padding:1px 2px 1px 2px;margin:0; } .tree li a:focus { outline: none; } .tree li a input, .tree li span input { margin:0;padding:0 0;display:inline-block;height:12px !important;border:1px solid white;background:white;font-size:10px;font-family:Verdana; } .tree li a input:not([class="xxx"]), .tree li span input:not([class="xxx"]) { padding:1px 0; } /* FOR DOTS */ .tree .ltr li.last { float:left; } .tree > ul li.last { overflow:hidden; } /* OPEN OR CLOSE */ .tree li.open ul { display:block; } .tree li.closed ul { display:none !important; } /* FOR DRAGGING */ #jstree-dragged { position:absolute; top:-10px; left:-10px; margin:0; padding:0; } #jstree-dragged ul ul ul { display:none; } #jstree-marker { padding:0; margin:0; line-height:5px; font-size:1px; overflow:hidden; height:5px; position:absolute; left:-45px; top:-30px; z-index:1000; background-color:transparent; background-repeat:no-repeat; display:none; } #jstree-marker.marker { width:45px; background-position:-32px top; } #jstree-marker.marker_plus { width:5px; background-position:right top; } /* BACKGROUND DOTS */ .tree li li { overflow:hidden; } .tree > .ltr > li { display:table; } /* ICONS */ .tree ul ins { display:inline-block; text-decoration:none; width:16px; height:16px; } .tree .ltr ins { margin:0 4px 0 0px; } ';
f.browser.msie&&(6==f.browser.version&&(a+='.tree li { height:18px; zoom:1; } .tree li li { overflow:visible; } .tree .ltr li.last { margin-top: expression( (this.previousSibling && /open/.test(this.previousSibling.className) ) ? "-2px" : "0"); } .marker { width:45px; background-position:-32px top; } .marker_plus { width:5px; background-position:right top; }'),7==f.browser.version&&(a+='.tree li li { overflow:visible; } .tree .ltr li.last { margin-top: expression( (this.previousSibling && /open/.test(this.previousSibling.className) ) ? "-2px" : "0"); }'));
f.browser.opera&&(a+='.tree > ul > li.last:after { content:"."; display: block; height:1px; clear:both; visibility:hidden; }');f.browser.mozilla&&0==f.browser.version.indexOf("1.8")&&(a+=".tree .ltr li a { display:inline; float:left; } .tree li ul { clear:both; }");c.css=c.add_sheet({str:a})})})(jQuery);
(function(f){f.extend(f.tree.datastores,{html:function(){return{get:function(c,a){return c&&f(c).size()?f("<div>").append(a.get_node(c).clone()).html():a.container.children("ul:eq(0)").html()},parse:function(c,a,b,f){f&&f.call(null,c);return c},load:function(c,a,b,h){b.url?f.ajax({type:b.method,url:b.url,data:c,dataType:"html",success:function(a){h.call(null,a)},error:function(b,c,f){h.call(null,!1);a.error(f+" "+c)}}):h.call(null,b["static"]||a.container.children("ul:eq(0)").html())}}},json:function(){return{get:function(c,
a,b){var h=this;c=!c||0==f(c).size()?a.container.children("ul").children("li"):f(c);b||(b={});b.outer_attrib||(b.outer_attrib=["id","rel","class"]);b.inner_attrib||(b.inner_attrib=[]);if(1<c.size()){var d=[];c.each(function(){d.push(h.get(this,a,b))});return d}if(0==c.size())return[];var e={attributes:{},data:{}};c.hasClass("open")&&(e.data.state="open");c.hasClass("closed")&&(e.data.state="closed");for(var g in b.outer_attrib)if(b.outer_attrib.hasOwnProperty(g)){var j="class"==b.outer_attrib[g]?
c.attr(b.outer_attrib[g]).replace(/(^| )last( |$)/ig," ").replace(/(^| )(leaf|closed|open)( |$)/ig," "):c.attr(b.outer_attrib[g]);"undefined"!=typeof j&&0<j.toString().replace(" ","").length&&(e.attributes[b.outer_attrib[g]]=j);delete j}if(a.settings.languages.length)for(g in a.settings.languages){if(a.settings.languages.hasOwnProperty(g)){var l=c.children("a."+a.settings.languages[g]);if(b.force||b.inner_attrib.length||l.children("ins").get(0).style.backgroundImage.toString().length||l.children("ins").get(0).className.length){if(e.data[a.settings.languages[g]]=
{},e.data[a.settings.languages[g]].title=a.get_text(c,a.settings.languages[g]),l.children("ins").get(0).style.className.length&&(e.data[a.settings.languages[g]].icon=l.children("ins").get(0).style.className),l.children("ins").get(0).style.backgroundImage.length&&(e.data[a.settings.languages[g]].icon=l.children("ins").get(0).style.backgroundImage.replace("url(","").replace(")","")),b.inner_attrib.length){e.data[a.settings.languages[g]].attributes={};for(var k in b.inner_attrib)b.inner_attrib.hasOwnProperty(k)&&
(j=l.attr(b.inner_attrib[k]),"undefined"!=typeof j&&0<j.toString().replace(" ","").length&&(e.data[a.settings.languages[g]].attributes[b.inner_attrib[k]]=j),delete j)}}else e.data[a.settings.languages[g]]=a.get_text(c,a.settings.languages[g])}}else if(l=c.children("a"),e.data.title=a.get_text(c),l.children("ins").size()&&l.children("ins").get(0).className.length&&(e.data.icon=l.children("ins").get(0).className),l.children("ins").size()&&l.children("ins").get(0).style.backgroundImage.length&&(e.data.icon=
l.children("ins").get(0).style.backgroundImage.replace("url(","").replace(")","")),b.inner_attrib.length)for(k in e.data.attributes={},b.inner_attrib)b.inner_attrib.hasOwnProperty(k)&&(j=l.attr(b.inner_attrib[k]),"undefined"!=typeof j&&0<j.toString().replace(" ","").length&&(e.data.attributes[b.inner_attrib[k]]=j),delete j);0<c.children("ul").size()&&(e.children=[],c.children("ul").children("li").each(function(){e.children.push(h.get(this,a,b))}));return e},parse:function(c,a,b,f){if("[object Array]"===
Object.prototype.toString.apply(c)){for(var d="",e=0;e<c.length;e++)"function"!=typeof c[e]&&(d+=this.parse(c[e],a,b));f&&f.call(null,d);return d}if(!c||!c.data)return f&&f.call(null,!1),"";var d="<li ",g=!1;if(c.attributes)for(e in c.attributes)if(c.attributes.hasOwnProperty(e))if("class"==e){d+=" class='"+c.attributes[e]+" ";if("closed"==c.state||"open"==c.state)d+=" "+c.state+" ";d+="' ";g=!0}else d+=" "+e+"='"+c.attributes[e]+"' ";if(!g&&("closed"==c.state||"open"==c.state))d+=" class='"+c.state+
"' ";d+=">";if(a.settings.languages.length)for(e=0;e<a.settings.languages.length;e++){g={href:"",style:""};g["class"]=a.settings.languages[e];if(c.data[a.settings.languages[e]]&&"undefined"!=(typeof c.data[a.settings.languages[e]].attributes).toLowerCase())for(var j in c.data[a.settings.languages[e]].attributes)c.data[a.settings.languages[e]].attributes.hasOwnProperty(j)&&(g[j]="style"==j||"class"==j?g[j]+(" "+c.data[a.settings.languages[e]].attributes[j]):c.data[a.settings.languages[e]].attributes[j]);
d+="<a";for(j in g)g.hasOwnProperty(j)&&(d+=" "+j+'="'+g[j]+'" ');d+=">";d=c.data[a.settings.languages[e]]&&c.data[a.settings.languages[e]].icon?d+("<ins "+(-1==c.data[a.settings.languages[e]].icon.indexOf("/")?" class='"+c.data[a.settings.languages[e]].icon+"' ":" style='background-image:url(\""+c.data[a.settings.languages[e]].icon+"\");' ")+">&nbsp;</ins>"):d+"<ins>&nbsp;</ins>";d+=("undefined"!=(typeof c.data[a.settings.languages[e]].title).toLowerCase()?c.data[a.settings.languages[e]].title:c.data[a.settings.languages[e]])+
"</a>"}else{g={href:"",style:"","class":""};if("undefined"!=(typeof c.data.attributes).toLowerCase())for(e in c.data.attributes)c.data.attributes.hasOwnProperty(e)&&(g[e]="style"==e||"class"==e?g[e]+(" "+c.data.attributes[e]):c.data.attributes[e]);d+="<a";for(e in g)g.hasOwnProperty(e)&&(d+=" "+e+'="'+g[e]+'" ');d+=">";g=j=null;"object"==typeof c.data&&(e="icon","undefined"!=typeof c.data[e]&&(j=c.data[e]),e="title","undefined"!=typeof c.data[e]&&(g=c.data[e]));d=j?d+("<ins "+(-1==j.indexOf("/")?
" class='"+j+"' ":" style='background-image:url(\""+j+"\");' ")+">&nbsp;</ins>"):d+"<ins>&nbsp;</ins>";d+=(g?g:c.data)+"</a>"}if(c.children&&c.children.length){d+="<ul>";for(e=0;e<c.children.length;e++)d+=this.parse(c.children[e],a,b);d+="</ul>"}d+="</li>";f&&f.call(null,d);return d},load:function(c,a,b,h){b["static"]?h.call(null,b["static"]):f.ajax({type:b.method,url:b.url,data:c,dataType:"json",success:function(a){h.call(null,a)},error:function(b,c,f){h.call(null,!1);a.error(f+" "+c)}})}}}})})(jQuery);
function lp_display_folders(f,c){f.parents("li").css("display","");f.parents("li.closed").each(function(){c.open_branch(this,!0)})};
